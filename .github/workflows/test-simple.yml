name: 🧪 Simple Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  basic-test:
    name: 🔍 Basic Validation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate project structure
        run: |
          echo "🔍 Validating claude-ally project structure..."

          # Check core files
          required_files=(
            "claude-ally.sh"
            "setup.sh"
            "stack-detector.sh"
            "README.md"
          )

          for file in "${required_files[@]}"; do
            if [[ -f "$file" ]]; then
              echo "✅ $file found"
            else
              echo "❌ $file missing"
              exit 1
            fi
          done

          echo "🎉 Basic validation completed successfully"

      - name: Test CLI help command
        run: |
          echo "🧪 Testing CLI help command"
          chmod +x claude-ally.sh
          ./claude-ally.sh help

      - name: Test CLI version command
        run: |
          echo "🧪 Testing CLI version command"
          ./claude-ally.sh version

      - name: Run unit tests
        run: |
          echo "🧪 Running unit tests"
          if [[ -f "tests/run_all_tests.sh" ]]; then
            chmod +x tests/run_all_tests.sh
            chmod +x tests/unit/test_stack_detector.sh
            ./tests/run_all_tests.sh unit
          else
            echo "⚠️ Test runner not found, skipping unit tests"
          fi